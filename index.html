<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Control de Horarios</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            touch-action: pan-x pan-y;
        }

        .container-fluid {
            padding: 0;
            max-width: 100vw;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            text-align: center;
        }

        .date-selector {
            background: white;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .date-selector button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .date-selector button:active {
            transform: scale(0.95);
        }

        .date-display {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2a5298;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 10px;
            transition: background 0.2s;
            text-align: center;
            min-width: 200px;
        }

        .date-display:hover {
            background: #f0f0f0;
        }

        .content-section {
            padding: 15px;
        }

        .section-card {
            background: white;
            border-radius: 15px;
            padding: 20px 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .section-title h2 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2a5298;
            margin: 0;
        }

        .btn-add {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .btn-add:active {
            transform: scale(0.95);
        }

        .schedule-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .schedule-header {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 12px;
            border-radius: 8px 8px 0 0;
            font-weight: 700;
            font-size: 0.95rem;
            margin: -15px -15px 15px -15px;
        }

        .employee-row {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .employee-name {
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .days-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .day-cell {
            text-align: center;
            padding: 8px 4px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .day-header {
            background: #667eea;
            color: white;
        }

        .day-check {
            background: #38ef7d;
            color: white;
        }

        .day-double {
            background: #ffd700;
            color: #333;
        }

        .day-cross {
            background: #ff6b6b;
            color: white;
        }

        .day-hours {
            background: #4facfe;
            color: white;
            font-size: 0.7rem;
        }

        .total-amount {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #e0e0e0;
        }

        .total-label {
            font-weight: 700;
            color: #2a5298;
        }

        .total-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #11998e;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-edit, .btn-delete {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: transform 0.2s;
        }

        .btn-edit {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-delete {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn-edit:active, .btn-delete:active {
            transform: scale(0.95);
        }

        .form-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .form-container {
            background: white;
            min-height: 100vh;
            padding: 0;
            max-width: 100%;
            overflow-x: hidden;
        }

        .form-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .form-header h3 {
            font-size: 1.2rem;
            margin: 0;
            font-weight: 700;
        }

        .form-body {
            padding: 20px 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .day-toggle {
            text-align: center;
            padding: 12px 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.85rem;
            border: 2px solid #e0e0e0;
        }

        .day-toggle.active-check {
            background: #38ef7d;
            color: white;
            border-color: #38ef7d;
        }

        .day-toggle.active-double {
            background: #ffd700;
            color: #333;
            border-color: #ffd700;
        }

        .day-toggle.active-cross {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }

        .hours-input-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .hours-input-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .hours-input-wrapper label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 5px;
        }

        .hours-input-wrapper input {
            width: 100%;
            padding: 8px 4px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .form-actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 15px;
            border-top: 2px solid #e0e0e0;
            display: flex;
            gap: 10px;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }

        .btn-cancel, .btn-save {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-cancel {
            background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
            color: white;
        }

        .btn-save {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-cancel:active, .btn-save:active {
            transform: scale(0.98);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        input[type="date"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        /* Estilos para el modal de advertencia */
        .warning-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }

        .warning-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .warning-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .warning-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .warning-body {
            padding: 20px;
            text-align: center;
            font-size: 1rem;
            color: #333;
        }

        .warning-actions {
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .btn-warning-ok {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-warning-ok:active {
            transform: scale(0.95);
        }

        /* Estilos para el modal de confirmación de eliminación */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }

        .confirm-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .confirm-header {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .confirm-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .confirm-body {
            padding: 20px;
            text-align: center;
            font-size: 1rem;
            color: #333;
        }

        .confirm-actions {
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .btn-confirm-cancel {
            background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-confirm-delete {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-confirm-cancel:active, .btn-confirm-delete:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-clock"></i> Control de Horarios</h1>
        </div>

        <!-- Date Selector -->
        <div class="date-selector">
            <button onclick="changeWeek(-1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="date-display" onclick="showDatePicker()">
                <span id="currentWeekRange">Cargando...</span>
                <input type="date" id="datePicker" onchange="updateFromPicker()">
            </div>
            <button onclick="changeWeek(1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Content Section -->
        <div class="content-section">
            <!-- Horarios por Turnos -->
            <div class="section-card">
                <div class="section-title">
                    <h2><i class="fas fa-calendar-check"></i> Horarios por Turnos</h2>
                    <button class="btn-add" onclick="openTurnosForm()">
                        <i class="fas fa-plus"></i> Agregar
                    </button>
                </div>
                <div id="turnosContainer"></div>
            </div>

            <!-- Horarios por Horas -->
            <div class="section-card">
                <div class="section-title">
                    <h2><i class="fas fa-business-time"></i> Horarios por Horas</h2>
                    <button class="btn-add" onclick="openHorasForm()">
                        <i class="fas fa-plus"></i> Agregar
                    </button>
                </div>
                <div id="horasContainer"></div>
            </div>
        </div>
    </div>

    <!-- Form Overlay for Turnos -->
    <div class="form-overlay" id="turnosFormOverlay">
        <div class="form-container">
            <div class="form-header">
                <h3><i class="fas fa-calendar-plus"></i> <span id="turnosFormTitle">Agregar Horario por Turnos</span></h3>
            </div>
            <div class="form-body">
                <div class="form-group">
                    <label for="turnosActivacion">Activación / Empresa</label>
                    <input type="text" id="turnosActivacion" placeholder="Ej: Activacion Banco Promerica">
                </div>
                <div class="form-group">
                    <label>Empleados</label>
                    <div id="turnosEmpleadosContainer"></div>
                    <button class="btn-add" style="margin-top: 10px; width: 100%;" onclick="addTurnosEmpleado()">
                        <i class="fas fa-user-plus"></i> Agregar Empleado
                    </button>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn-cancel" onclick="closeTurnosForm()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-save" onclick="saveTurnos()">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Form Overlay for Horas -->
    <div class="form-overlay" id="horasFormOverlay">
        <div class="form-container">
            <div class="form-header">
                <h3><i class="fas fa-clock"></i> <span id="horasFormTitle">Agregar Horario por Horas</span></h3>
            </div>
            <div class="form-body">
                <div class="form-group">
                    <label for="horasActivacion">Activación / Empresa</label>
                    <input type="text" id="horasActivacion" placeholder="Ej: Activacion Banco Promerica">
                </div>
                <div class="form-group">
                    <label>Empleados</label>
                    <div id="horasEmpleadosContainer"></div>
                    <button class="btn-add" style="margin-top: 10px; width: 100%;" onclick="addHorasEmpleado()">
                        <i class="fas fa-user-plus"></i> Agregar Empleado
                    </button>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn-cancel" onclick="closeHorasForm()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-save" onclick="saveHoras()">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="warning-modal" id="warningModal">
        <div class="warning-content">
            <div class="warning-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Advertencia</h3>
            </div>
            <div class="warning-body">
                <p id="warningMessage">Por favor complete todos los campos obligatorios</p>
            </div>
            <div class="warning-actions">
                <button class="btn-warning-ok" onclick="closeWarningModal()">
                    <i class="fas fa-check"></i> Aceptar
                </button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3><i class="fas fa-trash-alt"></i> Confirmar Eliminación</h3>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage">¿Está seguro de eliminar este horario?</p>
            </div>
            <div class="confirm-actions">
                <button class="btn-confirm-cancel" onclick="closeConfirmModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-confirm-delete" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>

    <script>
        const PAGO_POR_TURNO = 15000;
        const PAGO_POR_HORA = 2500;
        const DIAS_SEMANA = ['L', 'M', 'K', 'J', 'V', 'S', 'D'];
        
        // Inicializar con la semana actual (lunes a domingo)
        let currentWeekStart = getMonday(new Date()); // Semana actual (lunes)
        let turnosData = loadData('turnosData') || {};
        let horasData = loadData('horasData') || {};
        let editingTurnosId = null;
        let editingHorasId = null;
        
        // Variables para el modal de confirmación
        let pendingDelete = {
            type: null, // 'turnos' o 'horas'
            id: null
        };

        // Cargar datos del localStorage
        function loadData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : {};
        }

        // Guardar datos en localStorage
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Obtener el lunes de la semana de una fecha
        function getMonday(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Ajustar para que la semana empiece en lunes
            return new Date(d.setDate(diff));
        }

        // Obtener el domingo de la semana de una fecha
        function getSunday(date) {
            const monday = getMonday(date);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            return sunday;
        }

        // Formatear fecha para mostrar
        function formatDate(date) {
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        // Formatear fecha para input date
        function formatDateInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Parsear fecha desde input date
        function parseDateInput(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return new Date(year, month - 1, day);
        }

        // Cambiar semana (adelante o atrás)
        function changeWeek(weeks) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (weeks * 7));
            updateWeekDisplay();
            renderAll();
        }

        // Mostrar selector de fecha
        function showDatePicker() {
            document.getElementById('datePicker').value = formatDateInput(currentWeekStart);
            document.getElementById('datePicker').showPicker();
        }

        // Actualizar desde el selector de fecha
        function updateFromPicker() {
            const dateStr = document.getElementById('datePicker').value;
            const selectedDate = parseDateInput(dateStr);
            currentWeekStart = getMonday(selectedDate);
            updateWeekDisplay();
            renderAll();
        }

        // Actualizar display de la semana
        function updateWeekDisplay() {
            const weekEnd = getSunday(currentWeekStart);
            document.getElementById('currentWeekRange').textContent = 
                `${formatDate(currentWeekStart)} - ${formatDate(weekEnd)}`;
        }

        // Mostrar modal de advertencia
        function showWarningModal(message) {
            document.getElementById('warningMessage').textContent = message;
            document.getElementById('warningModal').style.display = 'flex';
        }

        // Cerrar modal de advertencia
        function closeWarningModal() {
            document.getElementById('warningModal').style.display = 'none';
        }

        // Mostrar modal de confirmación
        function showConfirmModal(type, id) {
            pendingDelete.type = type;
            pendingDelete.id = id;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        // Cerrar modal de confirmación
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            pendingDelete.type = null;
            pendingDelete.id = null;
        }

        // Confirmar eliminación
        function confirmDelete() {
            if (pendingDelete.type === 'turnos') {
                deleteTurnosConfirmed(pendingDelete.id);
            } else if (pendingDelete.type === 'horas') {
                deleteHorasConfirmed(pendingDelete.id);
            }
            closeConfirmModal();
        }

        // Abrir formulario de turnos
        function openTurnosForm(id = null) {
            editingTurnosId = id;
            document.getElementById('turnosFormTitle').textContent = id ? 'Editar Horario por Turnos' : 'Agregar Horario por Turnos';
            
            // Obtener la clave de la semana actual
            const weekKey = getWeekKey(currentWeekStart);
            
            if (id && turnosData[weekKey] && turnosData[weekKey][id]) {
                const data = turnosData[weekKey][id];
                document.getElementById('turnosActivacion').value = data.activacion;
                
                document.getElementById('turnosEmpleadosContainer').innerHTML = '';
                data.empleados.forEach(emp => {
                    addTurnosEmpleado(emp);
                });
            } else {
                document.getElementById('turnosActivacion').value = '';
                document.getElementById('turnosEmpleadosContainer').innerHTML = '';
                addTurnosEmpleado();
            }
            
            document.getElementById('turnosFormOverlay').style.display = 'block';
        }

        // Cerrar formulario de turnos
        function closeTurnosForm() {
            document.getElementById('turnosFormOverlay').style.display = 'none';
            editingTurnosId = null;
        }

        // Alternar estado de día en turnos (check -> double -> cross -> check)
        function toggleDayTurnos(element) {
            if (element.classList.contains('active-check')) {
                element.classList.remove('active-check');
                element.classList.add('active-double');
            } else if (element.classList.contains('active-double')) {
                element.classList.remove('active-double');
                element.classList.add('active-cross');
            } else if (element.classList.contains('active-cross')) {
                element.classList.remove('active-cross');
                element.classList.add('active-check');
            } else {
                element.classList.add('active-check');
            }
        }

        // Agregar empleado al formulario de turnos
        function addTurnosEmpleado(data = null) {
            const container = document.getElementById('turnosEmpleadosContainer');
            
            const empDiv = document.createElement('div');
            empDiv.className = 'employee-row';
            empDiv.style.marginBottom = '15px';
            empDiv.innerHTML = `
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Nombre del Empleado</label>
                    <input type="text" class="empleado-nombre" placeholder="Nombre" value="${data ? data.nombre : ''}">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Extras (₡)</label>
                    <input type="number" min="0" step="0.01" class="empleado-extras" placeholder="0.00" value="${data ? (data.extras || 0) : 0}">
                </div>
                <div class="form-group">
                    <label>Días de la Semana</label>
                    <div class="days-grid">
                        ${DIAS_SEMANA.map((dia, index) => {
                            let stateClass = '';
                            if (data && data.dias[index] === 'check') {
                                stateClass = 'active-check';
                            } else if (data && data.dias[index] === 'double') {
                                stateClass = 'active-double';
                            } else {
                                stateClass = 'active-cross'; // Por defecto rojo
                            }
                            return `
                                <div class="day-toggle ${stateClass}" 
                                     data-day="${index}" 
                                     onclick="toggleDayTurnos(this)">
                                    ${dia}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                <button class="btn-delete" style="margin-top: 10px; width: 100%;" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Eliminar Empleado
                </button>
            `;
            
            container.appendChild(empDiv);
        }

        // Guardar datos de turnos
        function saveTurnos() {
            const activacion = document.getElementById('turnosActivacion').value.trim();
            
            if (!activacion) {
                showWarningModal('Por favor ingrese el nombre de la activación/empresa');
                return;
            }
            
            const empleadosElements = document.querySelectorAll('#turnosEmpleadosContainer .employee-row');
            const empleados = [];
            
            empleadosElements.forEach(empEl => {
                const nombre = empEl.querySelector('.empleado-nombre').value.trim();
                const extrasInput = empEl.querySelector('.empleado-extras').value;
                const extras = parseFloat(extrasInput) || 0;
                
                if (nombre) {
                    const dias = [];
                    empEl.querySelectorAll('.day-toggle').forEach(dayEl => {
                        if (dayEl.classList.contains('active-check')) {
                            dias.push('check');
                        } else if (dayEl.classList.contains('active-double')) {
                            dias.push('double');
                        } else {
                            dias.push('cross');
                        }
                    });
                    empleados.push({ nombre, dias, extras });
                }
            });
            
            if (empleados.length === 0) {
                showWarningModal('Debe agregar al menos un empleado');
                return;
            }
            
            const weekKey = getWeekKey(currentWeekStart);
            if (!turnosData[weekKey]) turnosData[weekKey] = {};
            
            const id = editingTurnosId || Date.now();
            turnosData[weekKey][id] = {
                activacion,
                empleados,
                fechaInicio: formatDateInput(currentWeekStart),
                fechaFin: formatDateInput(getSunday(currentWeekStart))
            };
            
            saveData('turnosData', turnosData);
            
            closeTurnosForm();
            renderAll();
        }

        // Mostrar confirmación para eliminar turnos
        function deleteTurnos(id) {
            showConfirmModal('turnos', id);
        }

        // Eliminar horario de turnos confirmado
        function deleteTurnosConfirmed(id) {
            const weekKey = getWeekKey(currentWeekStart);
            delete turnosData[weekKey][id];
            
            // Guardar en localStorage
            saveData('turnosData', turnosData);
            
            renderAll();
        }

        // Abrir formulario de horas
        function openHorasForm(id = null) {
            editingHorasId = id;
            document.getElementById('horasFormTitle').textContent = id ? 'Editar Horario por Horas' : 'Agregar Horario por Horas';
            
            // Obtener la clave de la semana actual
            const weekKey = getWeekKey(currentWeekStart);
            
            if (id && horasData[weekKey] && horasData[weekKey][id]) {
                const data = horasData[weekKey][id];
                document.getElementById('horasActivacion').value = data.activacion;
                
                document.getElementById('horasEmpleadosContainer').innerHTML = '';
                data.empleados.forEach(emp => {
                    addHorasEmpleado(emp);
                });
            } else {
                document.getElementById('horasActivacion').value = '';
                document.getElementById('horasEmpleadosContainer').innerHTML = '';
                addHorasEmpleado();
            }
            
            document.getElementById('horasFormOverlay').style.display = 'block';
        }

        // Cerrar formulario de horas
        function closeHorasForm() {
            document.getElementById('horasFormOverlay').style.display = 'none';
            editingHorasId = null;
        }

        // Agregar empleado al formulario de horas
        function addHorasEmpleado(data = null) {
            const container = document.getElementById('horasEmpleadosContainer');
            
            const empDiv = document.createElement('div');
            empDiv.className = 'employee-row';
            empDiv.style.marginBottom = '15px';
            empDiv.innerHTML = `
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Nombre del Empleado</label>
                    <input type="text" class="empleado-nombre" placeholder="Nombre" value="${data ? data.nombre : ''}">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Extras (₡)</label>
                    <input type="number" min="0" step="0.01" class="empleado-extras" placeholder="0.00" value="${data ? (data.extras || 0) : 0}">
                </div>
                <div class="form-group">
                    <label>Horas por Día</label>
                    <div class="hours-input-grid">
                        ${DIAS_SEMANA.map((dia, index) => `
                            <div class="hours-input-wrapper">
                                <label>${dia}</label>
                                <input type="number" min="0" step="0.5" class="hora-input" data-day="${index}" value="${data && data.horas[index] ? data.horas[index] : '0'}">
                            </div>
                        `).join('')}
                    </div>
                </div>
                <button class="btn-delete" style="margin-top: 10px; width: 100%;" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Eliminar Empleado
                </button>
            `;
            
            container.appendChild(empDiv);
        }

        // Guardar datos de horas
        function saveHoras() {
            const activacion = document.getElementById('horasActivacion').value.trim();
            
            if (!activacion) {
                showWarningModal('Por favor ingrese el nombre de la activación/empresa');
                return;
            }
            
            const empleadosElements = document.querySelectorAll('#horasEmpleadosContainer .employee-row');
            const empleados = [];
            
            empleadosElements.forEach(empEl => {
                const nombre = empEl.querySelector('.empleado-nombre').value.trim();
                const extrasInput = empEl.querySelector('.empleado-extras').value;
                const extras = parseFloat(extrasInput) || 0;
                
                if (nombre) {
                    const horas = [];
                    empEl.querySelectorAll('.hora-input').forEach(horaEl => {
                        horas.push(parseFloat(horaEl.value) || 0);
                    });
                    empleados.push({ nombre, horas, extras });
                }
            });
            
            if (empleados.length === 0) {
                showWarningModal('Debe agregar al menos un empleado');
                return;
            }
            
            const weekKey = getWeekKey(currentWeekStart);
            if (!horasData[weekKey]) horasData[weekKey] = {};
            
            const id = editingHorasId || Date.now();
            horasData[weekKey][id] = {
                activacion,
                empleados,
                fechaInicio: formatDateInput(currentWeekStart),
                fechaFin: formatDateInput(getSunday(currentWeekStart))
            };
            
            saveData('horasData', horasData);
            
            closeHorasForm();
            renderAll();
        }

        // Mostrar confirmación para eliminar horas
        function deleteHoras(id) {
            showConfirmModal('horas', id);
        }

        // Eliminar horario de horas confirmado
        function deleteHorasConfirmed(id) {
            const weekKey = getWeekKey(currentWeekStart);
            delete horasData[weekKey][id];
            
            // Guardar en localStorage
            saveData('horasData', horasData);
            
            renderAll();
        }

        // Obtener clave de semana para almacenamiento
        function getWeekKey(date) {
            return `week-${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
        }

        // Renderizar turnos
        function renderTurnos() {
            const container = document.getElementById('turnosContainer');
            const weekKey = getWeekKey(currentWeekStart);
            const data = turnosData[weekKey] || {};
            
            if (Object.keys(data).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>No hay horarios por turnos registrados</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = Object.entries(data).map(([id, item]) => `
                <div class="schedule-item">
                    <div class="schedule-header">
                        ${item.activacion}<br>
                        <small style="font-size: 0.8rem; opacity: 0.9;">${item.fechaInicio} al ${item.fechaFin}</small>
                    </div>
                    ${item.empleados.map(emp => {
                        const turnosCount = emp.dias.filter(d => d === 'check').length;
                        const dobleTurnosCount = emp.dias.filter(d => d === 'double').length;
                        const totalTurnos = turnosCount + (dobleTurnosCount * 2);
                        const total = (totalTurnos * PAGO_POR_TURNO) + (emp.extras || 0);
                        return `
                            <div class="employee-row">
                                <div class="employee-name">${emp.nombre}</div>
                                <div class="days-container">
                                    ${DIAS_SEMANA.map((dia, idx) => `
                                        <div class="day-cell day-header">${dia}</div>
                                    `).join('')}
                                    ${emp.dias.map((estado, idx) => {
                                        let dayClass = '';
                                        let symbol = '';
                                        if (estado === 'check') {
                                            dayClass = 'day-check';
                                            symbol = '✓';
                                        } else if (estado === 'double') {
                                            dayClass = 'day-double';
                                            symbol = '✓✓';
                                        } else {
                                            dayClass = 'day-cross';
                                            symbol = '✗';
                                        }
                                        return `<div class="day-cell ${dayClass}">${symbol}</div>`;
                                    }).join('')}
                                </div>
                                <div class="total-amount">
                                    <span class="total-label">Turnos: ${totalTurnos} | Extras: ₡${(emp.extras || 0).toLocaleString('es-CR')}</span>
                                    <span class="total-value">₡${total.toLocaleString('es-CR')}</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    <div class="action-buttons">
                        <button class="btn-edit" onclick="openTurnosForm('${id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn-delete" onclick="deleteTurnos('${id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Renderizar horas
        function renderHoras() {
            const container = document.getElementById('horasContainer');
            const weekKey = getWeekKey(currentWeekStart);
            const data = horasData[weekKey] || {};
            
            if (Object.keys(data).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <p>No hay horarios por horas registrados</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = Object.entries(data).map(([id, item]) => `
                <div class="schedule-item">
                    <div class="schedule-header">
                        ${item.activacion}<br>
                        <small style="font-size: 0.8rem; opacity: 0.9;">${item.fechaInicio} al ${item.fechaFin}</small>
                    </div>
                    ${item.empleados.map(emp => {
                        const totalHoras = emp.horas.reduce((sum, h) => sum + h, 0);
                        const total = (totalHoras * PAGO_POR_HORA) + (emp.extras || 0);
                        return `
                            <div class="employee-row">
                                <div class="employee-name">${emp.nombre}</div>
                                <div class="days-container">
                                    ${DIAS_SEMANA.map((dia, idx) => `
                                        <div class="day-cell day-header">${dia}</div>
                                    `).join('')}
                                    ${emp.horas.map((horas, idx) => `
                                        <div class="day-cell day-hours">
                                            ${horas > 0 ? horas + 'h' : '-'}
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="total-amount">
                                    <span class="total-label">Total horas: ${totalHoras}h | Extras: ₡${(emp.extras || 0).toLocaleString('es-CR')}</span>
                                    <span class="total-value">₡${total.toLocaleString('es-CR')}</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    <div class="action-buttons">
                        <button class="btn-edit" onclick="openHorasForm('${id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn-delete" onclick="deleteHoras('${id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Renderizar todo
        function renderAll() {
            renderTurnos();
            renderHoras();
        }

        // Inicializar
        updateWeekDisplay();
        renderAll();
    </script>
</body>
</html>
